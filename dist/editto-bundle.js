"use strict";var _createClass=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var eDittoButtonBar=function(t){function n(){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));t.buttons=t.querySelectorAll("button");for(var e=0;e<t.buttons.length;e++)t.setButtonAction(t.buttons[e]);return t.startButtonsCheck(),t.addEventListener("mousedown",function(t){t.preventDefault()}),t}return _inherits(n,HTMLElement),_createClass(n,null,[{key:"observedAttributes",get:function(){return["editto"]}}]),_createClass(n,[{key:"setButtonAction",value:function(t){var e=this,n=this,o=t.dataset.edittoFormat,i=t.dataset.edittoFormatValue||null;o&&t.addEventListener("click",function(){e.blur(),n.eDitto.format(o,i)})}},{key:"attributeChangedCallback",value:function(t,e,n){if("editto"==t){this.eDitto=document.getElementById(n);var o=this;this.eDitto.addEventListener("focus",function(){o.classList.remove("editto-button-bar--lost-focus"),o.classList.add("editto-button-bar--focus")}),this.eDitto.addEventListener("blur",function(){o.classList.remove("editto-button-bar--focus"),o.classList.add("editto-button-bar--lost-focus"),setTimeout(function(t){return o.classList.remove("editto-button-bar--lost-focus")},1e3)})}}},{key:"startButtonsCheck",value:function(){var t=this;setInterval(function(){t.checkButtonsFormat()},500)}},{key:"checkButtonsFormat",value:function(){for(var t=0;t<this.buttons.length;t++)this.checkButtomFormat(this.buttons[t])}},{key:"checkButtomFormat",value:function(t){var e=t.dataset.edittoFormat;return e&&this.eDitto.checkFormat(e)?(t.classList.add("edito-button__active"),this.eDitto.checkFormat(e)):(t.classList.remove("edito-button__active"),!1)}}]),n}();customElements.define("editto-button-bar",eDittoButtonBar);var eDitto=function(t){function n(){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));t.innerHTML;t.allowEdition(),t._lastSelectionRange=null;var e=t;return t.addEventListener("focus",function(t){e._interval=setInterval(function(){e._lastSelectionRange=e.selectionRange||e._lastSelectionRange},100),e._lastSelectionRange&&e.restoreSelection(e._lastSelectionRange)},!1),t.addEventListener("blur",function(t){clearInterval(e._interval)}),t}return _inherits(n,HTMLElement),_createClass(n,null,[{key:"observedAttributes",get:function(){return["w","l"]}}]),_createClass(n,[{key:"isEditable",value:function(){return this.isContentEditable}},{key:"allowEdition",value:function(){this.contentEditable=!0}},{key:"disallowEdition",value:function(){this.contentEditable=!1}},{key:"format",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.focus(),e&&this.checkFormat(t,e)?document.execCommand("removeFormat",!1,t):document.execCommand(t,null,e)}},{key:"insertElement",value:function(t,e){if(this.focus(),e)for(var n in e){var o="{{ "+n+" }}";t=eDittoHelpers.replaceAll(t,o,eDittoHelpers.escapeHTML(e[n]))}var i=document.createElement("div");i.innerHTML=t,this.selectionRange.collapse(!1),this.selectionRange.insertNode(i)}},{key:"insertText",value:function(t){this.insertElement(eDittoHelpers.escapeHTML(t))}},{key:"insertFromTemplate",value:function(t,e){var n=new XMLHttpRequest,o=this;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=this.responseText+"<br/>";o.insertElement(t,e)}},n.open("GET",t,!0),n.send()}},{key:"checkFormat",value:function(t,e){return e?document.queryCommandValue(t)==e:document.queryCommandState(t)}},{key:"restoreSelection",value:function(t){if(t){if(window.getSelection){var e=window.getSelection();e.removeAllRanges(),e.addRange(t)}else document.selection&&t.select&&t.select();return t}}},{key:"toggleBold",value:function(){this.format("bold")}},{key:"toggleItalic",value:function(){this.format("italic")}},{key:"toggleUnderline",value:function(){this.format("underline")}},{key:"querySelector",value:function(t){}},{key:"value",get:function(){return this.innerHTML},set:function(t){for(;-1!=t.indexOf("<script>");)t=t.replace("<script>","&ltscript&gt");for(;-1!=t.indexOf("<\/script>");)t=t.replace("<\/script>","&lt/script&gt");this.innerHTML=t}},{key:"numberCharacters",get:function(){return eDittoHelpers.countCharacters(this.textContent)}},{key:"selection",get:function(){var t=null;return this===document.activeElement&&(document.getSelection?t=document.getSelection():document.getSelection()?t=document.getSelection():document.selection&&(t=document.selection.createRange().text)),t}},{key:"selectionRange",get:function(){var t=null;return this===document.activeElement?this.selection.getRangeAt?t=this.selection.getRangeAt(0):((t=document.createRange()).setStart(userSelection.anchorNode,userSelection.anchorOffset),t.setEnd(userSelection.focusNode,userSelection.focusOffset)):t=this._lastSelectionRange,t}},{key:"selectedText",get:function(){var t=null;try{t=this.selection.toString()}catch(t){}return 0<t.length?t:null}},{key:"selectedHTML",get:function(){var t=null;try{var e=this.selectionRange.cloneContents(),n=document.createElement("div");n.appendChild(e),t=n.innerHTML}catch(t){}return 0<t.length?t:null}}]),n}();customElements.define("editto-editor",eDitto);var eDittoHelpers=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"countCharacters",value:function(t){var e=0;for(var n in t)" "!=t[n]&&e++;return e}},{key:"countWords",value:function(){}}],[{key:"insertAfter",value:function(t,e){var n=e.parentNode;n.lastchild==e?n.appendChild(t):n.insertBefore(t,e.nextSibling)}},{key:"getFileLocation",value:function(){for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var n=t[e].src,o=-1<n.indexOf("editto.min.js")?n.indexOf("editto.min.js"):n.indexOf("editto.js");if(-1<o){var i=n.substring(0,o);return i.substring(i.indexOf("dist"),0)}}return!1}},{key:"replaceAll",value:function(t,e,n){for(t=t||"";-1!=t.indexOf(e);)t=t.replace(e,n);return t}},{key:"escapeHTML",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return t=this.replaceAll(this.replaceAll(t,"<","&lt"),">","&gt")}}]),t}();