"use strict";var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var eDitto=function(e){function n(){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));e.innerHTML;e.allowEdition(),e._lastSelectionRange=null;var t=e;return e.addEventListener("focus",function(e){t._interval=setInterval(function(){t._lastSelectionRange=t.selectionRange||t._lastSelectionRange},100),t._lastSelectionRange&&t.restoreSelection(t._lastSelectionRange)},!1),e.addEventListener("blur",function(e){clearInterval(t._interval)}),e}return _inherits(n,HTMLElement),_createClass(n,null,[{key:"observedAttributes",get:function(){return["w","l"]}}]),_createClass(n,[{key:"isEditable",value:function(){return this.isContentEditable}},{key:"allowEdition",value:function(){this.contentEditable=!0}},{key:"disallowEdition",value:function(){this.contentEditable=!1}},{key:"format",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.focus(),t&&this.checkFormat(e,t)?document.execCommand("removeFormat",!1,e):document.execCommand(e,null,t)}},{key:"insertElement",value:function(e,t){if(this.focus(),t)for(var n in t){var i="{{ "+n+" }}";e=eDittoHelpers.replaceAll(e,i,eDittoHelpers.escapeHTML(t[n]))}var r=document.createElement("div");r.innerHTML=e,this.selectionRange.collapse(!1),this.selectionRange.insertNode(r)}},{key:"insertText",value:function(e){this.insertElement(eDittoHelpers.escapeHTML(e))}},{key:"insertFromTemplate",value:function(e,t){var n=new XMLHttpRequest,i=this;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=this.responseText+"<br/>";i.insertElement(e,t)}},n.open("GET",e,!0),n.send()}},{key:"checkFormat",value:function(e,t){return t?document.queryCommandValue(e)==t:document.queryCommandState(e)}},{key:"restoreSelection",value:function(e){if(e){if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select();return e}}},{key:"toggleBold",value:function(){this.format("bold")}},{key:"toggleItalic",value:function(){this.format("italic")}},{key:"toggleUnderline",value:function(){this.format("underline")}},{key:"querySelector",value:function(e){}},{key:"value",get:function(){return this.innerHTML},set:function(e){for(;-1!=e.indexOf("<script>");)e=e.replace("<script>","&ltscript&gt");for(;-1!=e.indexOf("<\/script>");)e=e.replace("<\/script>","&lt/script&gt");this.innerHTML=e}},{key:"numberCharacters",get:function(){return eDittoHelpers.countCharacters(this.textContent)}},{key:"selection",get:function(){var e=null;return this===document.activeElement&&(document.getSelection?e=document.getSelection():document.getSelection()?e=document.getSelection():document.selection&&(e=document.selection.createRange().text)),e}},{key:"selectionRange",get:function(){var e=null;return this===document.activeElement?this.selection.getRangeAt?e=this.selection.getRangeAt(0):((e=document.createRange()).setStart(userSelection.anchorNode,userSelection.anchorOffset),e.setEnd(userSelection.focusNode,userSelection.focusOffset)):e=this._lastSelectionRange,e}},{key:"selectedText",get:function(){var e=null;try{e=this.selection.toString()}catch(e){}return 0<e.length?e:null}},{key:"selectedHTML",get:function(){var e=null;try{var t=this.selectionRange.cloneContents(),n=document.createElement("div");n.appendChild(t),e=n.innerHTML}catch(e){}return 0<e.length?e:null}}]),n}();customElements.define("editto-editor",eDitto);var eDittoHelpers=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"countCharacters",value:function(e){var t=0;for(var n in e)" "!=e[n]&&t++;return t}},{key:"countWords",value:function(){}}],[{key:"insertAfter",value:function(e,t){var n=t.parentNode;n.lastchild==t?n.appendChild(e):n.insertBefore(e,t.nextSibling)}},{key:"getFileLocation",value:function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++){var n=e[t].src,i=-1<n.indexOf("editto.min.js")?n.indexOf("editto.min.js"):n.indexOf("editto.js");if(-1<i){var r=n.substring(0,i);return r.substring(r.indexOf("dist"),0)}}return!1}},{key:"replaceAll",value:function(e,t,n){for(e=e||"";-1!=e.indexOf(t);)e=e.replace(t,n);return e}},{key:"escapeHTML",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return e=this.replaceAll(this.replaceAll(e,"<","&lt"),">","&gt")}}]),e}();